# pcp_combine  hourly

[config]

LOOP_BY = INIT
#
INIT_TIME_FMT = %Y%m%d%H%M
#
INIT_BEG = 202006151700
#
INIT_END = 202006151700
#
INIT_INCREMENT = 3600
#
LEAD_SEQ = 1

MODEL= WOFS
OBTYPE = MRMS_QPE

# Options are times, processes
# times = run all items in the PROCESS_LIST for a single initialization
# time, then repeat until all times have been evaluated.
# processes = run each item in the PROCESS_LIST for all times
#   specified, then repeat for the next item in the PROCESS_LIST.
LOOP_ORDER = times

# List of applications to run
PROCESS_LIST = PcpCombine, EnsembleStat, GridStat

LOG_PCP_COMBINE_VERBOSITY = 3
LOG_ENSEMBLE_STAT_VERBOSITY = 3
LOG_GRID_STAT_VERBOSITY = 3

#### PCP COMBINE ####

FCST_PCP_COMBINE_RUN = TRUE
FCST_PCP_COMBINE_INPUT_DATATYPE = GRIB
FCST_PCP_COMBINE_METHOD = USER_DEFINED
FCST_PCP_COMBINE_BUCKET_INTERVAL = 1
FCST_PCP_COMBINE_INPUT_DATATYPE = GRIB
FCST_PCP_COMBINE_FIELD_NAME = APCP
FCST_PCP_COMBINE_INPUT_ACCUMS = 1

PCP_COMBINE_SKIP_IF_OUTPUT_EXISTS = TRUE

PCP_COMBINE_CUSTOM_LOOP_LIST = 01, 02, 03, 04, 05, 06, 07, 08, 09, 10, 11, 12, 13, 14, 15, 16, 17, 18 

FCST_PCP_COMBINE_COMMAND = -sum 00000000_000000 1 {valid?fmt=%Y%m%d}_{valid?fmt=%H%M}00 1 -pcpdir {FCST_PCP_COMBINE_INPUT_DIR}/{FCST_PCP_COMBINE_INPUT_TEMPLATE} -pcprx wofs -field 'name="APCP";level="A1";'

#### ENSEMBLE STAT ####

ENSEMBLE_STAT_N_MEMBERS = 18
ENSEMBLE_STAT_ENS_THRESH = 1.0
ENSEMBLE_STAT_REGRID_TO_GRID = FCST

ENSEMBLE_STAT_CONFIG_FILE = {CONFIG_DIR}/EnsembleStatConfig_WOFS

FCST_ENSEMBLE_STAT_INPUT_GRID_DATATYPE = NETCDF
OBS_ENSEMBLE_STAT_INPUT_GRID_DATATYPE = NETCDF

ENSEMBLE_STAT_OUTPUT_PREFIX = {MODEL}_PCP_{init?fmt=%H%M}_{lead?fmt=%H%M}00L_A1

FCST_ENSEMBLE_STAT_VAR1_NAME = APCP_01
FCST_ENSEMBLE_STAT_VAR1_LEVELS = "(*,*)"
FCST_ENSEMBLE_STAT_VAR1_THRESH = >=12.7, >=25.4, >=50.8

OBS_ENSEMBLE_STAT_VAR1_NAME = GaugeCorrQPE01H_01
OBS_ENSEMBLE_STAT_VAR1_LEVELS = "(*,*)"
OBS_ENSEMBLE_STAT_VAR1_THRESH = {FCST_ENSEMBLE_STAT_VAR1_THRESH}

#### GRID STAT ####
#
GRID_STAT_REGRID_TO_GRID = FCST

GRID_STAT_CONFIG_FILE = {CONFIG_DIR}/GridStatConfig_WOFS_PCP_1H

FCST_GRID_STAT_INPUT_GRID_DATATYPE = NETCDF
OBS_GRID_STAT_INPUT_GRID_DATATYPE = NETCDF
GRID_STAT_NEIGHBORHOOD_SHAPE = SQUARE
GRID_STAT_NEIGHBORHOOD_WIDTH = 1, 3, 5


FCST_GRID_STAT_VAR1_NAME = APCP_01_A1_ENS_NMEP_ge12.7_NBRHD1_NEAREST1
FCST_GRID_STAT_VAR1_LEVELS = "(*,*)"
FCST_GRID_STAT_VAR1_OPTIONS = prob = TRUE
FCST_GRID_STAT_VAR1_THRESH = >=0.0, >=0.05, >=0.15, >=0.25, >=0.35, >=0.45, >=0.55, >=0.65, >=0.75, >=0.85, >=0.95, >=1.0
#
FCST_GRID_STAT_VAR2_NAME = APCP_01_A1_ENS_NMEP_ge25.4_NBRHD1_NEAREST1
FCST_GRID_STAT_VAR2_LEVELS = {FCST_GRID_STAT_VAR1_LEVELS}
FCST_GRID_STAT_VAR2_OPTIONS = {FCST_GRID_STAT_VAR1_OPTIONS}
FCST_GRID_STAT_VAR2_THRESH = {FCST_GRID_STAT_VAR1_THRESH}

FCST_GRID_STAT_VAR3_NAME = APCP_01_A1_ENS_NMEP_ge50.8_NBRHD1_NEAREST1
FCST_GRID_STAT_VAR3_LEVELS = {FCST_GRID_STAT_VAR1_LEVELS}
FCST_GRID_STAT_VAR3_OPTIONS = {FCST_GRID_STAT_VAR1_OPTIONS}
FCST_GRID_STAT_VAR3_THRESH = {FCST_GRID_STAT_VAR1_THRESH}

FCST_GRID_STAT_VAR4_NAME = APCP_01_A1_ENS_NMEP_ge12.7_NBRHD25_NEAREST1
FCST_GRID_STAT_VAR4_LEVELS = {FCST_GRID_STAT_VAR1_LEVELS}
FCST_GRID_STAT_VAR4_OPTIONS = {FCST_GRID_STAT_VAR1_OPTIONS}
FCST_GRID_STAT_VAR4_THRESH = {FCST_GRID_STAT_VAR1_THRESH}

FCST_GRID_STAT_VAR5_NAME = APCP_01_A1_ENS_NMEP_ge25.4_NBRHD25_NEAREST1
FCST_GRID_STAT_VAR5_LEVELS = {FCST_GRID_STAT_VAR1_LEVELS}
FCST_GRID_STAT_VAR5_OPTIONS = {FCST_GRID_STAT_VAR1_OPTIONS}
FCST_GRID_STAT_VAR5_THRESH = {FCST_GRID_STAT_VAR1_THRESH}

FCST_GRID_STAT_VAR6_NAME = APCP_01_A1_ENS_NMEP_ge50.8_NBRHD25_NEAREST1
FCST_GRID_STAT_VAR6_LEVELS = {FCST_GRID_STAT_VAR1_LEVELS}
FCST_GRID_STAT_VAR6_OPTIONS = {FCST_GRID_STAT_VAR1_OPTIONS}
FCST_GRID_STAT_VAR6_THRESH = {FCST_GRID_STAT_VAR1_THRESH}

FCST_GRID_STAT_VAR7_NAME = APCP_01_A1_ENS_NMEP_ge12.7_NBRHD81_NEAREST1
FCST_GRID_STAT_VAR7_LEVELS = {FCST_GRID_STAT_VAR1_LEVELS}
FCST_GRID_STAT_VAR7_OPTIONS = {FCST_GRID_STAT_VAR1_OPTIONS}
FCST_GRID_STAT_VAR7_THRESH = {FCST_GRID_STAT_VAR1_THRESH}

FCST_GRID_STAT_VAR8_NAME = APCP_01_A1_ENS_NMEP_ge25.4_NBRHD81_NEAREST1
FCST_GRID_STAT_VAR8_LEVELS = {FCST_GRID_STAT_VAR1_LEVELS}
FCST_GRID_STAT_VAR8_OPTIONS = {FCST_GRID_STAT_VAR1_OPTIONS}
FCST_GRID_STAT_VAR8_THRESH = {FCST_GRID_STAT_VAR1_THRESH}

FCST_GRID_STAT_VAR9_NAME = APCP_01_A1_ENS_NMEP_ge50.8_NBRHD81_NEAREST1
FCST_GRID_STAT_VAR9_LEVELS = {FCST_GRID_STAT_VAR1_LEVELS}
FCST_GRID_STAT_VAR9_OPTIONS = {FCST_GRID_STAT_VAR1_OPTIONS}
FCST_GRID_STAT_VAR9_THRESH = {FCST_GRID_STAT_VAR1_THRESH}

FCST_GRID_STAT_VAR10_NAME = APCP_01_A1_ENS_NMEP_ge12.7_NBRHD1_NEAREST1
FCST_GRID_STAT_VAR10_LEVELS = {FCST_GRID_STAT_VAR1_LEVELS}
FCST_GRID_STAT_VAR10_OPTIONS = prob = FALSE
FCST_GRID_STAT_VAR10_THRESH = >=0.5

FCST_GRID_STAT_VAR11_NAME = APCP_01_A1_ENS_NMEP_ge25.4_NBRHD1_NEAREST1
FCST_GRID_STAT_VAR11_LEVELS = {FCST_GRID_STAT_VAR1_LEVELS}
FCST_GRID_STAT_VAR11_OPTIONS = {FCST_GRID_STAT_VAR10_OPTIONS}
FCST_GRID_STAT_VAR11_THRESH = {FCST_GRID_STAT_VAR10_THRESH}

FCST_GRID_STAT_VAR12_NAME = APCP_01_A1_ENS_NMEP_ge50.8_NBRHD1_NEAREST1
FCST_GRID_STAT_VAR12_LEVELS = {FCST_GRID_STAT_VAR1_LEVELS}
FCST_GRID_STAT_VAR12_OPTIONS = {FCST_GRID_STAT_VAR10_OPTIONS}
FCST_GRID_STAT_VAR12_THRESH = {FCST_GRID_STAT_VAR10_THRESH}

FCST_GRID_STAT_VAR13_NAME = APCP_01_A1_ENS_NMEP_ge12.7_NBRHD25_NEAREST1
FCST_GRID_STAT_VAR13_LEVELS = {FCST_GRID_STAT_VAR1_LEVELS}
FCST_GRID_STAT_VAR13_OPTIONS = {FCST_GRID_STAT_VAR10_OPTIONS}
FCST_GRID_STAT_VAR13_THRESH = {FCST_GRID_STAT_VAR10_THRESH}

FCST_GRID_STAT_VAR14_NAME = APCP_01_A1_ENS_NMEP_ge25.4_NBRHD25_NEAREST1
FCST_GRID_STAT_VAR14_LEVELS = {FCST_GRID_STAT_VAR1_LEVELS}
FCST_GRID_STAT_VAR14_OPTIONS = {FCST_GRID_STAT_VAR10_OPTIONS}
FCST_GRID_STAT_VAR14_THRESH = {FCST_GRID_STAT_VAR10_THRESH}

FCST_GRID_STAT_VAR15_NAME = APCP_01_A1_ENS_NMEP_ge50.8_NBRHD25_NEAREST1
FCST_GRID_STAT_VAR15_LEVELS = {FCST_GRID_STAT_VAR1_LEVELS}
FCST_GRID_STAT_VAR15_OPTIONS = {FCST_GRID_STAT_VAR10_OPTIONS}
FCST_GRID_STAT_VAR15_THRESH = {FCST_GRID_STAT_VAR10_THRESH}

FCST_GRID_STAT_VAR16_NAME = APCP_01_A1_ENS_NMEP_ge12.7_NBRHD81_NEAREST1
FCST_GRID_STAT_VAR16_LEVELS = {FCST_GRID_STAT_VAR1_LEVELS}
FCST_GRID_STAT_VAR16_OPTIONS = {FCST_GRID_STAT_VAR10_OPTIONS}
FCST_GRID_STAT_VAR16_THRESH = {FCST_GRID_STAT_VAR10_THRESH}

FCST_GRID_STAT_VAR17_NAME = APCP_01_A1_ENS_NMEP_ge25.4_NBRHD81_NEAREST1
FCST_GRID_STAT_VAR17_LEVELS = {FCST_GRID_STAT_VAR1_LEVELS}
FCST_GRID_STAT_VAR17_OPTIONS = {FCST_GRID_STAT_VAR10_OPTIONS}
FCST_GRID_STAT_VAR17_THRESH = {FCST_GRID_STAT_VAR10_THRESH}

FCST_GRID_STAT_VAR18_NAME = APCP_01_A1_ENS_NMEP_ge50.8_NBRHD81_NEAREST1
FCST_GRID_STAT_VAR18_LEVELS = {FCST_GRID_STAT_VAR1_LEVELS}
FCST_GRID_STAT_VAR18_OPTIONS = {FCST_GRID_STAT_VAR10_OPTIONS}
FCST_GRID_STAT_VAR18_THRESH = {FCST_GRID_STAT_VAR10_THRESH}

OBS_GRID_STAT_VAR1_NAME = GaugeCorrQPE01H_01
OBS_GRID_STAT_VAR1_LEVELS = "(*,*)"
OBS_GRID_STAT_VAR1_THRESH = >=12.7

OBS_GRID_STAT_VAR2_NAME = GaugeCorrQPE01H_01
OBS_GRID_STAT_VAR2_LEVELS = {OBS_GRID_STAT_VAR1_LEVELS}
OBS_GRID_STAT_VAR2_THRESH = >=25.4

OBS_GRID_STAT_VAR3_NAME = GaugeCorrQPE01H_01
OBS_GRID_STAT_VAR3_LEVELS = {OBS_GRID_STAT_VAR1_LEVELS}
OBS_GRID_STAT_VAR3_THRESH = >=50.8

OBS_GRID_STAT_VAR4_NAME = GaugeCorrQPE01H_01
OBS_GRID_STAT_VAR4_LEVELS = {OBS_GRID_STAT_VAR1_LEVELS}
OBS_GRID_STAT_VAR4_THRESH = >=12.7

OBS_GRID_STAT_VAR5_NAME = GaugeCorrQPE01H_01
OBS_GRID_STAT_VAR5_LEVELS = {OBS_GRID_STAT_VAR1_LEVELS}
OBS_GRID_STAT_VAR5_THRESH = >=25.4

OBS_GRID_STAT_VAR6_NAME = GaugeCorrQPE01H_01
OBS_GRID_STAT_VAR6_LEVELS = {OBS_GRID_STAT_VAR1_LEVELS}
OBS_GRID_STAT_VAR6_THRESH = >=50.8

OBS_GRID_STAT_VAR7_NAME = GaugeCorrQPE01H_01
OBS_GRID_STAT_VAR7_LEVELS = {OBS_GRID_STAT_VAR1_LEVELS}
OBS_GRID_STAT_VAR7_THRESH = >=12.7

OBS_GRID_STAT_VAR8_NAME = GaugeCorrQPE01H_01
OBS_GRID_STAT_VAR8_LEVELS = {OBS_GRID_STAT_VAR1_LEVELS}
OBS_GRID_STAT_VAR8_THRESH = >=25.4

OBS_GRID_STAT_VAR9_NAME = GaugeCorrQPE01H_01
OBS_GRID_STAT_VAR9_LEVELS = {OBS_GRID_STAT_VAR1_LEVELS}
OBS_GRID_STAT_VAR9_THRESH = >=50.8

OBS_GRID_STAT_VAR10_NAME = GaugeCorrQPE01H_01
OBS_GRID_STAT_VAR10_LEVELS = {OBS_GRID_STAT_VAR1_LEVELS}
OBS_GRID_STAT_VAR10_THRESH = >=12.7

OBS_GRID_STAT_VAR11_NAME = GaugeCorrQPE01H_01
OBS_GRID_STAT_VAR11_LEVELS = {OBS_GRID_STAT_VAR1_LEVELS}
OBS_GRID_STAT_VAR11_THRESH = >=25.4

OBS_GRID_STAT_VAR12_NAME = GaugeCorrQPE01H_01
OBS_GRID_STAT_VAR12_LEVELS = {OBS_GRID_STAT_VAR1_LEVELS}
OBS_GRID_STAT_VAR12_THRESH = >=50.8

OBS_GRID_STAT_VAR13_NAME = GaugeCorrQPE01H_01
OBS_GRID_STAT_VAR13_LEVELS = {OBS_GRID_STAT_VAR1_LEVELS}
OBS_GRID_STAT_VAR13_THRESH = >=12.7

OBS_GRID_STAT_VAR14_NAME = GaugeCorrQPE01H_01
OBS_GRID_STAT_VAR14_LEVELS = {OBS_GRID_STAT_VAR1_LEVELS}
OBS_GRID_STAT_VAR14_THRESH = >=25.4

OBS_GRID_STAT_VAR15_NAME = GaugeCorrQPE01H_01
OBS_GRID_STAT_VAR15_LEVELS = {OBS_GRID_STAT_VAR1_LEVELS}
OBS_GRID_STAT_VAR15_THRESH = >=50.8

OBS_GRID_STAT_VAR16_NAME = GaugeCorrQPE01H_01
OBS_GRID_STAT_VAR16_LEVELS = {OBS_GRID_STAT_VAR1_LEVELS}
OBS_GRID_STAT_VAR16_THRESH = >=12.7

OBS_GRID_STAT_VAR17_NAME = GaugeCorrQPE01H_01
OBS_GRID_STAT_VAR17_LEVELS = {OBS_GRID_STAT_VAR1_LEVELS}
OBS_GRID_STAT_VAR17_THRESH = >=25.4

OBS_GRID_STAT_VAR18_NAME = GaugeCorrQPE01H_01
OBS_GRID_STAT_VAR18_LEVELS = {OBS_GRID_STAT_VAR1_LEVELS}
OBS_GRID_STAT_VAR18_THRESH = >=50.8

GRID_STAT_OUTPUT_PREFIX = {MODEL}_PCP_{init?fmt=%H%M}_A1

[dir]
# Directory for MET configuration files
CONFIG_DIR={PARM_BASE}/use_cases/model_applications/precipitation

FCST_PCP_COMBINE_INPUT_DIR = {INPUT_BASE}/model_applications/precipitation/WOFS/ensemble
FCST_PCP_COMBINE_OUTPUT_DIR = {OUTPUT_BASE}/{MODEL}/pcp_combine

FCST_ENSEMBLE_STAT_INPUT_DIR = {FCST_PCP_COMBINE_OUTPUT_DIR}
OBS_ENSEMBLE_STAT_GRID_INPUT_DIR = {INPUT_BASE}/model_applications/precipitation/WOFS/OBS
ENSEMBLE_STAT_OUTPUT_DIR = {OUTPUT_BASE}/{MODEL}/ensemble_stat

FCST_GRID_STAT_INPUT_DIR = {ENSEMBLE_STAT_OUTPUT_DIR}
OBS_GRID_STAT_INPUT_DIR = {OBS_ENSEMBLE_STAT_GRID_INPUT_DIR}
GRID_STAT_OUTPUT_DIR = {OUTPUT_BASE}/{MODEL}/grid_stat

[filename_templates]
FCST_PCP_COMBINE_INPUT_TEMPLATE = {init?fmt=%Y%m%d?shift=-44100}/{init?fmt=%H%M}/ENS_MEM_{custom?fmt=%s}
FCST_PCP_COMBINE_OUTPUT_TEMPLATE = {init?fmt=%Y%m%d?shift=-44100}/{init?fmt=%H%M}/ENS_MEM_{custom?fmt=%s}/wofs{custom?fmt=%s}_PCP_{init?fmt=%Y%m%d}_{init?fmt=%H%M}_{valid?fmt=%H%M}_A1.nc

FCST_ENSEMBLE_STAT_INPUT_TEMPLATE = {init?fmt=%Y%m%d?shift=-44100}/{init?fmt=%H%M}/ENS_MEM_??/wofs??_PCP_{init?fmt=%Y%m%d}_{init?fmt=%H%M}_{valid?fmt=%H%M}_A1.nc

OBS_ENSEMBLE_STAT_GRID_INPUT_TEMPLATE = {init?fmt=%Y%m%d?shift=-44100}/{init?fmt=%H%M}/mrms_PCP_{init?fmt=%Y%m%d}_{init?fmt=%H%M}_{valid?fmt=%H%M}_A1.nc

ENSEMBLE_STAT_OUTPUT_TEMPLATE = {init?fmt=%Y%m%d?shift=-44100}/{init?fmt=%H%M}

FCST_GRID_STAT_INPUT_TEMPLATE = {ENSEMBLE_STAT_OUTPUT_TEMPLATE}/ensemble_stat_{MODEL}_PCP_{init?fmt=%H%M}_{lead?fmt=%H%M}00L_A1_{init?fmt=%Y%m%d}_{valid?fmt=%H%M}00V_ens.nc
OBS_GRID_STAT_INPUT_TEMPLATE = {init?fmt=%Y%m%d?shift=-44100}/{init?fmt=%H%M}/mrms_PCP_{init?fmt=%Y%m%d}_{init?fmt=%H%M}_{valid?fmt=%H%M}_A1.nc
GRID_STAT_OUTPUT_TEMPLATE = {init?fmt=%Y%m%d?shift=-44100}/{init?fmt=%H%M}/

GRID_STAT_VERIFICATION_MASK_TEMPLATE = {INPUT_BASE}/model_applications/precipitation/WOFS/domain/WOFS_domain_{init?fmt=%Y%m%d}.nc